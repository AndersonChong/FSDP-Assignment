# ğŸ—ï¸ System Architecture & Data Flow

## Overall System Architecture

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                 â”‚
â”‚                    USER FRONTEND (React)                        â”‚
â”‚                    http://localhost:3000                        â”‚
â”‚                                                                 â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”        â”‚
â”‚  â”‚  Create  â”‚  â”‚   Chat   â”‚  â”‚ Feedback â”‚  â”‚   Save   â”‚        â”‚
â”‚  â”‚  Agent   â”‚  â”‚  Page    â”‚  â”‚ Buttons  â”‚  â”‚ Response â”‚        â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜        â”‚
â”‚       â”‚              â”‚              â”‚             â”‚             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
        â”‚              â”‚              â”‚             â”‚
        â”‚         HTTP Requests (JSON)              â”‚
        â”‚    â†“         â†“              â†“             â†“
        â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                   â”‚
â”‚               BACKEND (FastAPI) - http://localhost:8000          â”‚
â”‚                                                                   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”    â”‚
â”‚  â”‚                    CORS Middleware                      â”‚    â”‚
â”‚  â”‚         (Allows browser to send requests)               â”‚    â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜    â”‚
â”‚                             â”‚                                    â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â” â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”  â”Œâ”€â”€â”€â”€â”  â”‚
â”‚  â”‚  /agents  â”‚  â”‚ /chat  â”‚ â”‚/feedbackâ”‚  â”‚   /kb    â”‚  â”‚/..â”‚  â”‚
â”‚  â”‚ (routes)  â”‚  â”‚(routes)â”‚ â”‚(routes) â”‚  â”‚ (routes) â”‚  â”‚ .. â”‚  â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”˜ â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜  â””â”€â”€â”€â”€â”˜  â”‚
â”‚                                                                   â”‚
â”‚                             â”‚ Database Calls                    â”‚
â”‚                             â†“                                    â”‚
â”‚                  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                       â”‚
â”‚                  â”‚  Firestore Client    â”‚                       â”‚
â”‚                  â”‚  (Firebase Admin)    â”‚                       â”‚
â”‚                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                       â”‚
â”‚                                                                   â”‚
â”‚              â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                â”‚
â”‚              â”‚ OpenAI Integration              â”‚                â”‚
â”‚              â”‚ (gpt-4o-mini)                   â”‚                â”‚
â”‚              â”‚ For chat responses              â”‚                â”‚
â”‚              â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                                                                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                             â”‚                    â”‚
              HTTP Requests  â”‚                    â”‚  Firestore API
                             â†“                    â†“
            
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                                                                â”‚
â”‚                  EXTERNAL SERVICES                            â”‚
â”‚                                                                â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”         â”‚
â”‚  â”‚  OpenAI API     â”‚            â”‚  Google Cloud   â”‚         â”‚
â”‚  â”‚  (Responses)    â”‚            â”‚  Firestore      â”‚         â”‚
â”‚  â”‚                 â”‚            â”‚  (Database)     â”‚         â”‚
â”‚  â”‚ gpt-4o-mini     â”‚            â”‚                 â”‚         â”‚
â”‚  â”‚ gpt-3.5-turbo   â”‚            â”‚  Collections:   â”‚         â”‚
â”‚  â”‚ gpt-4           â”‚            â”‚  - agents       â”‚         â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â”‚  - feedback     â”‚         â”‚
â”‚                                  â”‚  - knowledge_.. â”‚         â”‚
â”‚                                  â”‚  - saved_res... â”‚         â”‚
â”‚                                  â”‚  - agent_chains â”‚         â”‚
â”‚                                  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜         â”‚
â”‚                                                                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Chat with Bot

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER   â”‚ Types: "How do I learn JavaScript?"
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND        â”‚
â”‚  ChatInterface   â”‚ Captures message
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ POST /chat
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                         â”‚
â”‚  /chat route                     â”‚
â”‚                                  â”‚
â”‚  1. Receive: {                   â”‚
â”‚       agent_id: "abc123",        â”‚
â”‚       user_message: "How do...?" â”‚
â”‚     }                            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ Query Firestore
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FIRESTORE                       â”‚
â”‚  agents collection               â”‚
â”‚                                  â”‚
â”‚  Retrieve:                       â”‚
â”‚  {                               â”‚
â”‚    name: "JS Expert",            â”‚
â”‚    role: "Teacher",              â”‚
â”‚    specialties: ["javascript"],  â”‚
â”‚    guidelines: "Be clear..."     â”‚
â”‚  }                               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                         â”‚
â”‚  Build System Prompt             â”‚
â”‚                                  â”‚
â”‚  "You are JS Expert..."          â”‚
â”‚  "Specialties: javascript"       â”‚
â”‚  "Be clear and simple"           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ API Call
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPENAI API                      â”‚
â”‚                                  â”‚
â”‚  POST /chat/completions          â”‚
â”‚  model: "gpt-4o-mini"            â”‚
â”‚  messages: [                     â”‚
â”‚    {role: "system",              â”‚
â”‚     content: "You are..."},      â”‚
â”‚    {role: "user",                â”‚
â”‚     content: "How do I...?"}     â”‚
â”‚  ]                               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPENAI                          â”‚
â”‚  Generates Response              â”‚
â”‚                                  â”‚
â”‚  "To learn JavaScript:           â”‚
â”‚   1. Start with variables...     â”‚
â”‚   2. Learn functions...          â”‚
â”‚   ..."                           â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                         â”‚
â”‚  /chat route                     â”‚
â”‚  Returns: {                      â”‚
â”‚    reply: "To learn JS:..."      â”‚
â”‚  }                               â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ HTTP Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND                        â”‚
â”‚  ChatInterface                   â”‚
â”‚  setMessages([...prev,           â”‚
â”‚    {sender: "bot",               â”‚
â”‚     text: "To learn JS:..."}     â”‚
â”‚  ])                              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER                            â”‚
â”‚  Sees bot response in chat       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Submit Feedback

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER            â”‚
â”‚  Sees response   â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ Clicks: ğŸ‘ or ğŸ‘ or ğŸš©
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND                      â”‚
â”‚  ChatInterface                 â”‚
â”‚                                â”‚
â”‚  handleFeedback() triggered    â”‚
â”‚                                â”‚
â”‚  Call: submitFeedback({        â”‚
â”‚    chat_id: "chat_123",        â”‚
â”‚    message_id: "msg_456",      â”‚
â”‚    agent_id: "agent_abc",      â”‚
â”‚    feedback_type: "thumbs_up", â”‚
â”‚    user_comment: "Great!"      â”‚
â”‚  })                            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ POST /feedback
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                       â”‚
â”‚  /feedback route               â”‚
â”‚                                â”‚
â”‚  Save to database:             â”‚
â”‚  db.save_feedback({            â”‚
â”‚    ...feedback data...         â”‚
â”‚  })                            â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ Write Firestore
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FIRESTORE                     â”‚
â”‚  feedback collection           â”‚
â”‚                                â”‚
â”‚  Create document:              â”‚
â”‚  {                             â”‚
â”‚    chat_id: "chat_123",        â”‚
â”‚    message_id: "msg_456",      â”‚
â”‚    agent_id: "agent_abc",      â”‚
â”‚    feedback_type: "thumbs_up", â”‚
â”‚    user_comment: "Great!",     â”‚
â”‚    created_at: "2026-01-14..." â”‚
â”‚  }                             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                       â”‚
â”‚  Returns: {                    â”‚
â”‚    status: "success",          â”‚
â”‚    feedback_id: "...",         â”‚
â”‚    message: "..."              â”‚
â”‚  }                             â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ HTTP Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND                      â”‚
â”‚  Shows: "Feedback received!"   â”‚
â”‚  Feedback button changes color â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Data Flow: Multi-Bot Chaining

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER                              â”‚
â”‚  Asks: "Review my JavaScript code" â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ Frontend selects both bots
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND                          â”‚
â”‚                                    â”‚
â”‚  Query Chain ({                    â”‚
â”‚    primary_agent_id: "tech_bot",   â”‚
â”‚    secondary_agent_id: "review_bot"â”‚
â”‚    user_message: "Review...",      â”‚
â”‚    pass_context: true              â”‚
â”‚  })                                â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ POST /chains/query
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                           â”‚
â”‚  /chains/query route               â”‚
â”‚                                    â”‚
â”‚  1. Get primary bot:               â”‚
â”‚     db.get_agent_by_id("tech_bot") â”‚
â”‚     â†’ Tech Support Bot profile     â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ Call OpenAI (Primary Bot)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPENAI                            â”‚
â”‚  (Tech Support Bot perspective)    â”‚
â”‚                                    â”‚
â”‚  Response: "This function uses     â”‚
â”‚  arrow function syntax. It's       â”‚
â”‚  concise and modern. The logic     â”‚
â”‚  is simple: returns sum of a+b.    â”‚
â”‚  Could add error handling though." â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ Primary response received
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                           â”‚
â”‚  /chains/query route               â”‚
â”‚                                    â”‚
â”‚  2. Get secondary bot:             â”‚
â”‚     db.get_agent_by_id("review_bot")â”‚
â”‚     â†’ Code Reviewer Bot profile    â”‚
â”‚                                    â”‚
â”‚  3. Create context message:        â”‚
â”‚     "Tech Bot said: [...response]  â”‚
â”‚      Now as Reviewer, enhance..."  â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ Call OpenAI (Secondary Bot)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  OPENAI                            â”‚
â”‚  (Code Reviewer Bot perspective)   â”‚
â”‚                                    â”‚
â”‚  Response: "Good use of arrow      â”‚
â”‚  functions. Suggestion: Add JSDoc  â”‚
â”‚  comments. Consider parameter      â”‚
â”‚  validation. Example:              â”‚
â”‚  /**                               â”‚
â”‚   * Adds two numbers               â”‚
â”‚   * @param {number} a              â”‚
â”‚   * @param {number} b              â”‚
â”‚   * @return {number} sum           â”‚
â”‚   */                               â”‚
â”‚  function add(a, b) { ... }"      â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ Both responses ready
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  BACKEND                           â”‚
â”‚  /chains/query route               â”‚
â”‚                                    â”‚
â”‚  4. Save conversation to DB        â”‚
â”‚  5. Return combined response:      â”‚
â”‚     {                              â”‚
â”‚       primary_agent: {...},        â”‚
â”‚       secondary_agent: {...},      â”‚
â”‚       combined_response: "..."     â”‚
â”‚     }                              â”‚
â””â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“ HTTP Response
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  FRONTEND                          â”‚
â”‚                                    â”‚
â”‚  Display side-by-side:             â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Tech Bot:                   â”‚   â”‚
â”‚  â”‚ "This function..."          â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”   â”‚
â”‚  â”‚ Reviewer Bot:               â”‚   â”‚
â”‚  â”‚ "Good use of arrow..."      â”‚   â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
     â”‚
     â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  USER                              â”‚
â”‚  Gets two perspectives!            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## Firestore Database Schema (Collections)

```
firestore/
â”‚
â”œâ”€â”€ agents (existing)
â”‚   â””â”€â”€ doc_id
â”‚       â”œâ”€â”€ id: "uuid"
â”‚       â”œâ”€â”€ name: "Tech Bot"
â”‚       â”œâ”€â”€ role: "assistant"
â”‚       â”œâ”€â”€ persona: "Expert"
â”‚       â”œâ”€â”€ specialties: ["JS", "Python"]
â”‚       â”œâ”€â”€ guidelines: "Be clear"
â”‚       â”œâ”€â”€ color: "#3a3a3a"
â”‚       â””â”€â”€ icon: "ğŸ¤–"
â”‚
â”œâ”€â”€ feedback (NEW)
â”‚   â””â”€â”€ doc_id (chat_123_msg_456)
â”‚       â”œâ”€â”€ chat_id: "chat_123"
â”‚       â”œâ”€â”€ message_id: "msg_456"
â”‚       â”œâ”€â”€ agent_id: "agent_abc"
â”‚       â”œâ”€â”€ feedback_type: "thumbs_up"
â”‚       â”œâ”€â”€ user_comment: "Great!"
â”‚       â””â”€â”€ created_at: "2026-01-14T10:30:45Z"
â”‚
â”œâ”€â”€ knowledge_base (NEW)
â”‚   â”œâ”€â”€ doc_id_1
â”‚   â”‚   â”œâ”€â”€ agent_id: "agent_abc"
â”‚   â”‚   â”œâ”€â”€ content: "Python is a language..."
â”‚   â”‚   â”œâ”€â”€ metadata: {
â”‚   â”‚   â”‚   source_type: "text",
â”‚   â”‚   â”‚   file_name: "python_basics.txt"
â”‚   â”‚   â”‚ }
â”‚   â”‚   â””â”€â”€ created_at: "2026-01-14T10:00:00Z"
â”‚   â”‚
â”‚   â””â”€â”€ doc_id_2
â”‚       â”œâ”€â”€ agent_id: "agent_abc"
â”‚       â”œâ”€â”€ content: "How to install... Q&A..."
â”‚       â”œâ”€â”€ metadata: {
â”‚       â”‚   source_type: "faq",
â”‚       â”‚   file_name: "faq.txt"
â”‚       â”‚ }
â”‚       â””â”€â”€ created_at: "2026-01-14T10:15:00Z"
â”‚
â”œâ”€â”€ saved_responses (NEW)
â”‚   â””â”€â”€ doc_id
â”‚       â”œâ”€â”€ agent_id: "agent_abc"
â”‚       â”œâ”€â”€ user_message: "How to debug?"
â”‚       â”œâ”€â”€ bot_response: "To debug: 1. Open console..."
â”‚       â”œâ”€â”€ tags: ["debugging", "javascript"]
â”‚       â”œâ”€â”€ created_at: "2026-01-14T10:30:45Z"
â”‚       â””â”€â”€ likes: 0
â”‚
â”œâ”€â”€ agent_chains (NEW)
â”‚   â””â”€â”€ doc_id
â”‚       â”œâ”€â”€ primary_agent_id: "tech_bot"
â”‚       â”œâ”€â”€ secondary_agent_id: "reviewer_bot"
â”‚       â””â”€â”€ created_at: "2026-01-14T10:00:00Z"
â”‚
â””â”€â”€ chain_conversations (NEW)
    â””â”€â”€ doc_id
        â”œâ”€â”€ primary_agent_id: "tech_bot"
        â”œâ”€â”€ secondary_agent_id: "reviewer_bot"
        â”œâ”€â”€ user_message: "Review my code"
        â”œâ”€â”€ primary_response: "Tech explanation..."
        â”œâ”€â”€ secondary_response: "Reviewer feedback..."
        â””â”€â”€ created_at: "2026-01-14T10:30:45Z"
```

---

## API Routes Structure

```
Backend: http://localhost:8000

â”œâ”€â”€ /agents
â”‚   â”œâ”€â”€ POST / ............... Create agent
â”‚   â”œâ”€â”€ GET / ................ List all agents
â”‚   â””â”€â”€ GET /{id} ............ Get single agent
â”‚
â”œâ”€â”€ /chat
â”‚   â””â”€â”€ POST / ............... Send message to bot
â”‚
â”œâ”€â”€ /feedback (NEW)
â”‚   â”œâ”€â”€ POST / ............... Submit feedback
â”‚   â”œâ”€â”€ GET /agent/{id} ...... Get all feedback
â”‚   â””â”€â”€ GET /stats/{id} ...... Get feedback stats
â”‚
â”œâ”€â”€ /kb (NEW)
â”‚   â”œâ”€â”€ POST /upload ......... Upload document
â”‚   â”œâ”€â”€ POST /upload-pdf ..... Upload PDF (auto extract)
â”‚   â”œâ”€â”€ POST /upload-text .... Upload text
â”‚   â”œâ”€â”€ POST /upload-url ..... Ingest URL
â”‚   â”œâ”€â”€ POST /faq ............ Upload FAQ
â”‚   â””â”€â”€ GET /agent/{id} ..... Get KB documents
â”‚
â”œâ”€â”€ /responses (NEW)
â”‚   â”œâ”€â”€ POST /save ........... Save/bookmark response
â”‚   â””â”€â”€ GET /agent/{id} ..... Get saved responses
â”‚
â””â”€â”€ /chains (NEW)
    â”œâ”€â”€ POST /link ........... Link two agents
    â”œâ”€â”€ POST /query .......... Query agent chain
    â””â”€â”€ GET /chains/{id} ..... Get linked agents
```

---

## Technology Stack

```
Frontend:
â”œâ”€â”€ React 19.2.0
â”œâ”€â”€ React Router DOM 7.9.5
â”œâ”€â”€ Firebase SDK 12.5.0
â”œâ”€â”€ React Icons 5.5.0
â”œâ”€â”€ Recharts 3.3.0 (charts)
â””â”€â”€ React Colorful 5.6.1 (color picker)

Backend:
â”œâ”€â”€ FastAPI (Web framework)
â”œâ”€â”€ Uvicorn (Server)
â”œâ”€â”€ OpenAI Python SDK (AI)
â”œâ”€â”€ Firebase Admin SDK (Database)
â”œâ”€â”€ PyPDF2 (PDF reading)
â”œâ”€â”€ Requests (HTTP)
â”œâ”€â”€ BeautifulSoup4 (HTML parsing)
â””â”€â”€ Pydantic (Data validation)

Database:
â””â”€â”€ Google Cloud Firestore (NoSQL)

External APIs:
â”œâ”€â”€ OpenAI (Chat completions)
â””â”€â”€ Google Cloud Firebase/Firestore
```

---

This architecture ensures:
âœ… Scalability (stateless backend)
âœ… Real-time feedback (Firestore)
âœ… Smart responses (OpenAI integration)
âœ… Multi-agent collaboration (chaining)
âœ… Knowledge management (KB uploads)
âœ… User satisfaction tracking (feedback)
